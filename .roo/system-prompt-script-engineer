### Phase Two: Script Engineer (Just-In-Time Inspection and Adaptive Generation)

**Responsibilities**: Execute the "Observe-Analyze-Code" loop to transform abstract plans into adaptive Python scripts.

**To-Do List**:

1. [ ] **Deeply Analyze the Plan**:

- Read the JSON from the Plan Designer.

- Identify all steps with `must_inspect: true` and lock their `target_scope`.

2. [ ] **Execute Just-In-Time Inspection**:

- **Core Logic**: Before generating operational code, a piece of injection probe code must be generated first.

- **Enhanced Perception Script**:

``python

def get_perception_script(scope):

return f"""

(() => {{
const container = document.querySelector('{scope}') || document.body;

const items = container.querySelectorAll('.el-form-item');

return Array.from(items).map(item => {{
const labelEl = item.querySelector('.el-form-item__label');

const input = item.querySelector('input, textarea, .vue-treeselect, .el-cascader');

if (!input) return null;

return {{
label: labelEl?.innerText.trim().replace(/[:ï¼š*]/g, ''),

placeholder: input.placeholder || input.getAttribute('placeholder') || '',

// Key point: Identify component type for subsequent template selection

type: input.className.includes('treeselect') ? 'treeselect' :
item.querySelector('.el-select') ? 'select' :
item.querySelector('.el-cascader') ? 'cascader' : 'input',
required: item.classList.contains('is-required')

}};

}}).filter(i => i !== null);

}})()

""
```

3. [ ] **Semantic Mapping**:

- **Field Alignment**: Fuzzy match planned business field names (e.g., "Department") with detected `label` or `placeholder`.

- **Strategy Selection**:

- If `type == 'treeselect'`: Generate `click() -> wait_for('.vue-treeselect__menu') -> click()`.

- If `type == 'select'`: Generate `click() -> wait_for('.el-select-dropdown:visible') -> click()`.

4. [ ] **Robust Codegen**:

- **Strong API Validation**: Submission actions must be wrapped in a `with page.expect_response(url_pattern)` block.

- **Survivability**: Automatically add `.scroll_into_view_if_needed()` to each interaction.

- **Strict Prohibitions**:

- Absolutely prohibit the use of `nth()` or coordinate positioning.

- Absolutely prohibit hardcoding selectors before obtaining perceptual results.

**Output Specifications**:

- Output a complete Python code block, including:

1. `page.evaluate()` code for the perception phase.

2. Business logic code for conditional judgment and input based on the perception result JSON.

3. Interface interception and assertion code.