# CodeSentinel自动化测试工作流

## 项目简介

**CodeSentinel**是一个为 AI 编码时代设计的**高级自动化测试工作流**。它将自动化测试工作流深度集成到大语言模型 (LLM) 的开发流程中，旨在解决传统测试需要花费大量人力时间与测试过程常常重复且枯燥的问题。
系统通过多模态架构，利用专业的 AI 角色，实现从代码审计、测试计划生成、测试用例设计、测试脚本编写，到自动执行和问题自我修复的全链路自动化。CodeSentinel 核心价值在于将测试工作成为一个高度自动化且高度稳定性的工作流，确保每一个测试的模块都可以被AI进行完整链路与高覆盖度的测试

## 系统架构的简要描述
CodeSentinel 采用多模态架构(Multimodal) 的模块化架构，将复杂的测试流程解耦为不同的Agent模块和执行环境，总的来讲就是“让专业的人做专业的事情
![alt text](image/image.png)

- 编排层(CoStrict/LLM)：
    - 作为中央控制器，我们认为这是AI的大脑，理解用户提出的指令，识别to_do_list调用正确的 AI Agent，并根据运行的结果驱动流程的推进（成功）或循环（失败）。
- AI Agents 层 (Custom Modes)：

| 角色名称 | 核心职责 | 输入与输出 | 核心工具/架构 |
| :--- | :--- | :--- | :--- |
| **Plan Designer** (测试计划设计师) | 审计代码，制定详细的测试计划，包括编写测试用例、定义测试步骤及测试判定标准。 | **输入**：源代码 / 需求文档<br>**输出**：结构化测试用例 (JSON) | 业务逻辑分析、JSON |
| **Script Engineer** (脚本工程师) | 阅读测试计划，编写探测器以定位前端元素，获取网页元素并生成自动化脚本。 | **输入**：结构化用例 (JSON)<br>**输出**：自动化测试脚本 | Playwright (前端) / Pytest (后端) |
| **Debugger** (调试工程师) | 执行测试脚本，监控运行状态，修复脚本运行错误并总结最终测试结果。 | **输入**：测试脚本<br>**输出**：测试报告 / 修复后的脚本 / 结果总结 | Python 调试工具、日志分析 |

- 执行与反馈层
    - 待测项目代码仓库，实际运行项目（前端/后端），运行结果信息反馈

- 拓展：
在我们的实际开发过程中，我们发现该工作流存在一些感知局限性问题以及模型的生成边界限制的问题，因此我们为该工作流添加了一些拓展来让模型更好的完成该测试工作

    -  黑盒页面探测拓展：在实际开发过程中我们发现因为vue页面是动态渲染的架构，因此AI模型可能会出现因为无法得知前端页面实际的页面的元素以及元素的位置而出现定位错误以及自行编造信息的情况，因此我们的为他添加了探测器来正确获取前端页面的元素。
    - 规范测试报告生成拓展：AI生成的内容具有随机性，因此我们需要给AI提供一个统一化模板拓展，来保证他每次生成的模板都符合我们的规定。

## 工作流介绍

![工作流图解](image/image2.png)

工作流用流程图如图所示



---

## 工作流测评测试报告
以下是我们团队对该工作流进行了多次测试后得到的一个大致测评报告

### 前端测试部分
1. 核心指标

| 统计项 | 数值 | 备注 |
| :--- | :--- | :--- |
| **总测试轮次** | 10 | 对应原始数据序号 2-10 |
| **成功次数** | 7 | 整体成功率 70% |
| **失败次数** | 3 | 主要集中在新增/修改模块 |
| **人工干预** | 0 | 流程实现了全自动化 |
| **总 Credit 消耗** | 430.0 | 均值约 47.8 / 次 |

2. 模块表现明细

| 模块范围 | 成功率 | 消耗特征 | 常见问题 |
| :--- | :--- | :--- | :--- |
| **登录 (/login)** | 100% | 低 (avg. 22) | 表现极佳，轻微重试即可成功 |
| **用户修改 (修改)** | 60% | 中 (avg. 31.5) | 存在“不符合预期”的情况 |
| **用户新增 (新增)** | 60% | 高 (avg. 71) | 复杂度最高，易在多用例运行时失败 |
| **综合测试** | 新增+删除+修改 | 40% | 中 (avg. 37.5) | 包含多次操作，容易出现失败案例 |

>注：本测评存在一定的缺陷，由于考虑到本次的比赛时间紧张和credit的限制因此没有能够进行足够多次数的测评。
3. 
### 后端测试部分
---



## 使用步骤
###  项目目录结构
```
.
├── workspace/         # AI 进行测试工作的核心目录：存放计划、脚本及生成汇报(也可以自行修改)
├── .roo/          # 存放 CoStrict 模型配置文件，请使用此文件夹进行配置
└── to_do_list     # 存放模型工作流to_do_list
└── frontend_config.json     # 前端测试配置文件
└── backend_config.json # 后端配置文件
└── mode_configure # 模型配置文件

```
### 配置模型

![alt text](image/image1.png)
1. 在vs code中搜索costrict插件，进行安装
2. 将`mode_configure`中的模型配置文件导入到vs code的cotrict插件，即可看到有三个模

### 使用教程

1. 斜杠命令的使用：
- 配置模式：斜杠命令`/config`进入配置模式,根据模型提示输入参数即可，也可以自行修改两个配置文件
- 测试模式：
    - `/Allapitest`：进入后端测试会自动进行所有的后端API测试
    - `/login-test`：进入前端登录模块测试
    - `add`：进入增加测试
    - `change`：进入修改测试
    - `/delete`：进入删除测试
    - `/format`：进入完整表单提交测试
    >更多自定义模式：为了用户可以更加细化的测试每个环境我们提供了一些可以进行分步测试的斜杠命令，你可以在.roo/commands看到所有的自定义模式
- 修复模式：经过我们的测试我们发现，让模型重新进行一次对失败脚本进行重新测试，可以有更高的脚本修正正确率，因此修复模式诞生了,使用`/fix`进入修复模式

## 难点与未来期望
### 难点

- 模型幻觉：
在开发过程中，模型幻觉是导致执行错误的主要因素。即使我们通过大量提示词对模型的行为边界进行约束，其实际效果依然有限。在执行过程中，模型仍可能生成不稳定、不可预测的结果，从而影响整体系统的可靠性。

**解决建议：** 为应对上述问题，我们在实践中总结出以下几种有效手段：

1. 分解小步骤：我们发现模型在执行较长、连续的任务流程时，幻觉问题尤为严重。因此，将任务拆分为更短、更明确的步骤，可以显著降低模型出现不可预测行为的概率。
2. 更优模型：在测试过程中，我们观察到使用性能更强、能力更稳定的模型，对缓解幻觉问题具有显著提升，其影响程度甚至在多数情况下高于提示词本身。
3. 模板化：
为了提升生成结果的一致性，我们为大模型提供结构化模板，使其在生成内容时更多地围绕模板进行填充和操作，而非进行开放式推理，从而有效减少幻觉的产生。

- 黑盒测试：
随着 AI 技术的发展，其在复杂文本分析、白盒分析以及代码理解方面已展现出极强能力。然而，在黑盒测试场景下，模型的表现仍难以满足实际需求。由于前端测试本质上往往属于黑盒测试范畴，如何有效引导 AI 感知并理解前端变化，成为本项目中的一项关键难点。
**解决方法：**
1.  探测器拓展：在脚本正式运行前，引导 AI 编写并注入探测器，用于主动获取网页元素及其状态信息。这一过程可以帮助模型在具备页面上下文的前提下进行分析，有效避免因缺乏页面认知而产生的“盲目猜测”。
2. 元素分类：为防止探测器返回的数据规模过大、超出模型的有效分析能力，我们对常见前端元素进行了分类处理。通过结构化与分层的方式，使模型在识别到对应元素类型时能够快速做出针对性的响应，从而提升整体分析效率与准确性。

### 未来期望
- **引入视觉方案：**  
  在前端测试中引入视觉测试方案，可以更高效地解决黑盒探测问题，并减少对纯文本分析的依赖，从而在保证准确性的同时节省更多的 Token 消耗。
- **支持更多语言：**  
  未来将逐步支持更多编程语言与前端技术栈，以适配不同技术背景与团队需求下的测试场景。
- **支持更多的 Web 架构：**  
  由于本次测试仅覆盖了传统的 Spring Boot + Vue 架构，后续将引入更适合现代 Web 架构的测试工作流，以支持微前端、SSR 以及前后端解耦等场景。
- **安全测试：**  
  在现有功能测试的基础上，进一步引入安全测试能力，包括常见漏洞扫描、异常输入检测等，以提升系统整体的安全性保障。
- **重复错误预防：**  
  在测试过程中，我们发现 AI 容易反复犯下相同类型的错误。为此，后续将考虑引入 RAG 等技术，为模型提供长期或任务级记忆能力，用于记录历史错误与修正策略，从而避免重复失误并持续提升测试质量。
