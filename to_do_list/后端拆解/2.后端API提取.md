# ğŸŸ¢ ä»»åŠ¡ä¸€ï¼šå¤šè¯­è¨€ API æå– (step1_extract.py)

## ğŸ“ å¾…æ‰§è¡ŒæŒ‡ä»¤ï¼š
- [ ] ç¡®è®¤ä¸Šä¸€æ­¥éª¤ä¸­æ‰€å¾—åˆ°çš„æ¨¡å‹è¯†åˆ«ç»“æœï¼Œç¡®å®šå½“å‰éœ€è¦è¯†åˆ«çš„ API è¯­è¨€ï¼Œåœ¨è¿™ä¸€æ­¥éª¤ä»…å®ŒæˆæŒ‡å®šè¯­è¨€çš„API æå–(è„šæœ¬ä¸­ä¸æ¶‰åŠåˆ°å…¶ä»–è¯­è¨€çš„APIæå–é€»è¾‘)
- [ ] åˆ›å»º `step1_extract.py`
- [ ] å°†æœ€åˆä¼ å…¥çš„æºä»£ç æ ¹ç›®å½•è·¯å¾„ç¡¬ç¼–ç è¿›å‡½æ•°ä¸­
- [ ] å®ç°ä¸»å‡½æ•° ï¼ˆè¿™é‡Œä»¥javaä¸ºä¾‹ï¼Œå…¶ä»–è¯­è¨€åŒç†ï¼‰
- [ ] è·å–æºä»£ç æ ¹ç›®å½•è·¯å¾„å®ç°å¸¸è§ API è·¯å¾„æ¨¡å¼æ¢æµ‹åŠŸèƒ½
- [ ] å®ç°å¤šæ–¹æ³•æ¢æµ‹ï¼ˆGET/POST/PUT/DELETE ç­‰ï¼‰
- [ ] å°†æ¢æµ‹ç»“æœä¸é™æ€åˆ†æç»“æœåˆå¹¶
- [ ] åœ¨ step1_extract.py ä¸­é›†æˆåŠ¨æ€æ¢æµ‹ç»“æœ

## ğŸ› ï¸ åˆ‡æ¢è‡³ [Script Engineer æ¨¡å¼]
   - èŒè´£ï¼šå®ç°æ ¸å¿ƒè§£æé€»è¾‘ï¼Œç¡®ä¿å¤šè¯­è¨€å…¼å®¹æ€§ä¸æ•°æ®ç»“æ„ç»Ÿä¸€ã€‚

```Python

import os, re, json

# 1. æ ¸å¿ƒè§£æé€»è¾‘ï¼šæ”¯æŒä» Java æºç ä¸­é™æ€æå– API ä¿¡æ¯
def extract_java_apis(source_root):
    apis = []
    # åŒ¹é… Controller è·¯å¾„ä¸æ–¹æ³•æ˜ å°„
    class_re = re.compile(r'@RequestMapping\("?([^"]*)"?\)')
    method_re = re.compile(r'@(Get|Post|Put|Delete)Mapping\("?([^"]*)"?\)')
    
    for root, _, files in os.walk(source_root):
        for file in files:
            if not file.endswith(".java"): continue
            with open(os.path.join(root, file), 'r', errors='ignore') as f:
                content = f.read()
                # æå–ç±»å‰ç¼€è·¯å¾„ (å–ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹)
                base = (class_re.findall(content) or [""])[0].strip("/")
                # æå–æ–¹æ³•çº§æ¥å£
                for m_type, path in method_re.findall(content):
                    clean_path = f"/{base}/{path.strip('/')}".replace("//", "/")
                    apis.append({
                        "path": clean_path,
                        "method": m_type.upper(),
                        "params": [{"name": p, "in": "path", "required": True} for p in re.findall(r'\{(.*?)\}', path)],
                        "payload": {"example_key": "example_value"} if m_type.upper() in ["POST", "PUT"] else None
                    })
    return apis

# 2. ç»Ÿä¸€è°ƒåº¦å™¨ï¼šæ ¹æ®è¯†åˆ«è¯­è¨€è°ƒç”¨è§£æå™¨å¹¶å»é‡
def run_extraction(config_path):
    with open(config_path, 'r') as f:
        config = json.load(f)
    
    src, lang, work_dir = config['project_path'], config['language'], config['work_dir']
    
    # è¯­è¨€è·¯ç”±
    raw_results = []
    if lang.lower() == "java":
        raw_results = extract_java_apis(src)
    # å¯åœ¨æ­¤æ‰©å±• extract_python_apis(src) ç­‰
    
    # [å»é‡å¤„ç†]ï¼šåŸºäº Method + Path å”¯ä¸€æ€§
    unique_data = {f"{a['method']}{a['path']}": a for a in raw_results}.values()
    return list(unique_data), work_dir
```
## ğŸ åˆ‡æ¢è‡³ [Debugger æ¨¡å¼]
   -  èŒè´£ï¼šæ‰§è¡Œè„šæœ¬ã€éªŒè¯æ•°æ®å®Œæ•´æ€§ã€ç”Ÿæˆæœ€ç»ˆäº¤ä»˜ç‰©ï¼ˆJSON & Markdownï¼‰ã€‚

```Python

if __name__ == "__main__":
    try:
        # 1. æ‰§è¡Œæå–é€»è¾‘
        # å‡è®¾ä¸Šä¸€æ­¥ç”Ÿæˆçš„é…ç½®æ–‡ä»¶åä¸º step0_config.json
        final_apis, work_dir = run_extraction("step0_config.json")
        
        # 2. å†™å…¥ apis.json (ä¾›åç»­ä»»åŠ¡ä½¿ç”¨)
        os.makedirs(work_dir, exist_ok=True)
        with open(f"{work_dir}/apis.json", 'w', encoding='utf-8') as f:
            json.dump(final_apis, f, indent=2, ensure_ascii=False)
            
        # 3. åˆå§‹åŒ–å¹¶ç”Ÿæˆ Final_Report.md (Swagger é£æ ¼æ–‡æ¡£)
        with open(f"{work_dir}/Final_Report.md", 'w', encoding='utf-8') as f:
            f.write(f"# ğŸ“– API æ¥å£é›†æˆæ–‡æ¡£\n\n> ç»Ÿè®¡ï¼šå…±å‘ç° **{len(final_apis)}** ä¸ªæœ‰æ•ˆæ¥å£\n\n")
            for api in final_apis:
                f.write(f"--- \n### ğŸ“ `{api['path']}`\n")
                f.write(f"- **Method**: `{api['method']}`\n")
                if api['params']:
                    f.write("- **Parameters**:\n" + "".join([f"  - `{p['name']}` ({p['in']})\n" for p in api['params']]))
                if api['payload']:
                    f.write(f"- **Valid Payload Example**:\n```json\n{json.dumps(api['payload'], indent=2)}\n```\n")
        
        print(f"âœ¨ [Debugger] éªŒè¯é€šè¿‡ï¼šå·²ç”Ÿæˆ {len(final_apis)} æ¡æ¥å£è®°å½•è‡³ {work_dir}")
        
    except Exception as e:
        print(f"âŒ [Debugger] è¿è¡Œå‡ºé”™: {str(e)}")
```
