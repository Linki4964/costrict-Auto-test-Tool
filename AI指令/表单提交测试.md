# ðŸ¤– Multi-Agent å®Œå…¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥ä½œæµ (è‹¥ä¾ç®¡ç†ç³»ç»Ÿä¸“ç”¨)
## ðŸ“Œ é¡¹ç›®èƒŒæ™¯
- **ç›®æ ‡**: å®žçŽ°å®Œå…¨ AI è‡ªä¸»æŽ¢æµ‹ä¸Žæµ‹è¯•ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚
- **æŒ‘æˆ˜**: è§£å†³ Vue/ElementUI é»‘ç›’ç»„ä»¶ï¼ˆTreeselect/Selectï¼‰çš„å®šä½éš¾é¢˜ã€‚
- **çŽ¯å¢ƒ**: RuoYi Admin (http://192.168.142.146/login)
- è´¦å·: admin å¯†ç :admin123

---

### é˜¶æ®µä¸€ï¼šå¿…é¡»åˆ‡æ¢å¿…é¡»åˆ‡æ¢Plan Designer (æˆ˜ç•¥è§„åˆ’å±‚)
**èŒè´£**: å»ºç«‹ä¸šåŠ¡é—­çŽ¯ï¼Œåˆ’å®šâ€œæ„ŸçŸ¥åŒºåŸŸâ€ã€‚

**ä»»åŠ¡æ¸…å• (To-Do)**:
1. [ ] **ä¸šåŠ¡å»ºæ¨¡**: å‰å¾€æºä»£ç çš„é¡µé¢"E:\project\Costric\RuoYi-Vue\RuoYi-Vue-master\ruoyi-ui"è¿›è¡Œå®¡è®¡APIæŽ¥å£ï¼Œä»…é’ˆå¯¹ `/system/user` é¡µé¢ï¼Œè§„åˆ’ [æ–°å¢ž -> ä¿®æ”¹ -> åˆ é™¤] å¹‚ç­‰æ€§é—­çŽ¯ã€‚
2. [ ] **æ„ŸçŸ¥ç‚¹æ ‡æ³¨**: æ¶‰åŠå¼¹çª—ï¼ˆDialogï¼‰æˆ–æŠ½å±‰ï¼ˆDrawerï¼‰çš„æ“ä½œå¿…é¡»æ ‡è®° `"must_inspect": true`ã€‚
3. [ ] **èŒƒå›´é™å®š**: ä¸ºæ¯ä¸€æ­¥æŒ‡å®š `target_scope`ï¼ˆpage / modal / drawer / form / table_rowï¼‰ã€‚
4. [ ] **API åŸ‹ç‚¹**: æ ‡æ³¨å…³é”®åŠ¨ä½œçš„æŽ¥å£åŒ¹é…è§„åˆ™ï¼ˆURL Pattern + Method + Expected Statusï¼‰ã€‚

**è¾“å‡ºè§„èŒƒ**:
- ä»…è¾“å‡ºçº¯ JSON æ•°ç»„ã€‚
- ä¸¥ç¦åŒ…å«ä»£ç æˆ–è§£é‡Šæ–‡å­—ã€‚
- ä¿å­˜è‡³å·¥ä½œåŒºï¼Œåˆ é™¤å¤šä½™çš„è®¡åˆ’æ–‡ä»¶åªä¿ç•™å”¯ä¸€è®¡åˆ’æ–‡ä»¶

---

### é˜¶æ®µäºŒï¼šScript Engineer (å³æ—¶æ„ŸçŸ¥ä¸Žè‡ªé€‚åº”ç”Ÿæˆ)

**èŒè´£**: æ‰§è¡Œâ€œè§‚å¯Ÿ-åˆ†æž-ç¼–ç â€å¾ªçŽ¯ï¼Œå°†æŠ½è±¡è®¡åˆ’è½¬åŒ–ä¸ºå…·å¤‡è‡ªé€‚åº”èƒ½åŠ›çš„ Python è„šæœ¬ã€‚

**ä»»åŠ¡æ¸…å• (To-Do)**:

1. [ ] **æ·±åº¦è§£æžè®¡åˆ’**:
    - è¯»å– Plan Designer çš„ JSONã€‚
    - è¯†åˆ«æ‰€æœ‰ `must_inspect: true` çš„æ­¥éª¤ï¼Œå¹¶é”å®šå…¶ `target_scope`ã€‚

2. [ ] **æ‰§è¡Œå³æ—¶æ„ŸçŸ¥ (JIT Inspection)**:
    - **æ ¸å¿ƒé€»è¾‘**: åœ¨ç”Ÿæˆæ“ä½œä»£ç å‰ï¼Œå¿…é¡»å…ˆç”Ÿæˆä¸€æ®µæ³¨å…¥å¼æŽ¢æµ‹ä»£ç ã€‚
    - **å¢žå¼ºåž‹æ„ŸçŸ¥è„šæœ¬**:
    ```python
    def get_perception_script(scope):
        return f"""
        (() => {{
            const container = document.querySelector('{scope}') || document.body;
            const items = container.querySelectorAll('.el-form-item');
            return Array.from(items).map(item => {{
                const labelEl = item.querySelector('.el-form-item__label');
                const input = item.querySelector('input, textarea, .vue-treeselect, .el-cascader');
                if (!input) return null;
                
                return {{
                    label: labelEl?.innerText.trim().replace(/[:ï¼š*]/g, ''),
                    placeholder: input.placeholder || input.getAttribute('placeholder') || '',
                    // å…³é”®ç‚¹ï¼šè¯†åˆ«ç»„ä»¶ç±»åž‹ï¼Œç”¨äºŽåŽç»­é€‰æ‹©æ¨¡æ¿
                    type: input.className.includes('treeselect') ? 'treeselect' : 
                          item.querySelector('.el-select') ? 'select' : 
                          item.querySelector('.el-cascader') ? 'cascader' : 'input',
                    required: item.classList.contains('is-required')
                }};
            }}).filter(i => i !== null);
        }})()
        """
    ```

3. [ ] **æ™ºèƒ½è¯­ä¹‰æ˜ å°„ (Semantic Mapping)**:
    - **å­—æ®µå¯¹é½**: å°†è®¡åˆ’ä¸­çš„ä¸šåŠ¡å­—æ®µåï¼ˆå¦‚â€œå½’å±žéƒ¨é—¨â€ï¼‰ä¸ŽæŽ¢æµ‹åˆ°çš„ `label` æˆ– `placeholder` è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚
    - **ç­–ç•¥é€‰æ‹©**: 
        - è‹¥ `type == 'treeselect'`: ç”Ÿæˆ `click() -> wait_for('.vue-treeselect__menu') -> click()`ã€‚
        - è‹¥ `type == 'select'`: ç”Ÿæˆ `click() -> wait_for('.el-select-dropdown:visible') -> click()`ã€‚

4. [ ] **ç¨³å¥ä»£ç ç”Ÿæˆ (Robust Codegen)**:
    - **API å¼ºæ ¡éªŒ**: æäº¤åŠ¨ä½œå¿…é¡»åŒ…è£¹åœ¨ `with page.expect_response(url_pattern)` å—ä¸­ã€‚
    - **ç”Ÿå­˜èƒ½åŠ›**: è‡ªåŠ¨ä¸ºæ¯ä¸ªäº¤äº’æ·»åŠ  `.scroll_into_view_if_needed()`ã€‚
    - **ä¸¥ç¦äº‹é¡¹**: 
        - ç»å¯¹ç¦æ­¢ä½¿ç”¨ `nth()` æˆ–åæ ‡å®šä½ã€‚
        - ç»å¯¹ç¦æ­¢åœ¨æœªèŽ·å–æ„ŸçŸ¥ç»“æžœå‰ç¡¬ç¼–ç é€‰æ‹©å™¨ã€‚

**è¾“å‡ºè§„èŒƒ**:
- è¾“å‡ºå®Œæ•´çš„ Python ä»£ç å—ï¼ŒåŒ…å«ï¼š
  1. `page.evaluate()` æ„ŸçŸ¥é˜¶æ®µä»£ç ã€‚
  2. åŸºäºŽæ„ŸçŸ¥ç»“æžœ JSON è¿›è¡Œæ¡ä»¶åˆ¤æ–­å’Œå¡«å†™çš„ä¸šåŠ¡ä»£ç ã€‚
  3. æŽ¥å£æ‹¦æˆªä¸Žæ–­è¨€ä»£ç ã€‚




---

### ç¬¬ä¸‰é˜¶æ®µï¼šDebugger (æ‰§è¡Œã€è‡ªæ„ˆä¸Žå®¡è®¡å±‚)
**èŒè´£**: è¿è¡Œè„šæœ¬ã€å®žæ—¶æ•èŽ·å¼‚å¸¸ã€è‡ªåŠ¨ä¿®å¤å®šä½åå·®ã€æ’°å†™æŠ¥å‘Šå¹¶è’¸é¦ä»£ç ã€‚
**ä»»åŠ¡æ¸…å• (To-Do)**:
1. [ ] **çŽ¯å¢ƒé¢„æ´— (Environment Pre-wash)**:
    - è¿è¡Œå‰æ£€ç´¢ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å†²çªæ•°æ®ï¼ˆå¦‚ `test_ai`ï¼‰ã€‚
    - è‹¥å­˜åœ¨ï¼Œè‡ªåŠ¨æ‰§è¡Œ API åˆ é™¤æˆ–æ•°æ®åº“é‡ç½®ï¼Œç¡®ä¿â€œå¹²å‡€â€çš„æ‰§è¡ŒçŽ¯å¢ƒã€‚
2. [ ] **åŠ¨æ€æ‰§è¡Œä¸Žç›‘æŽ§ (Execution & Watch)**:
    - è¿è¡Œ `Script Engineer` ç”Ÿæˆçš„åˆå§‹è„šæœ¬ã€‚
    - å®žæ—¶æ‹¦æˆª Console Error å’Œç½‘ç»œè¯·æ±‚å¼‚å¸¸ï¼ˆ4xx, 5xxï¼‰ã€‚
3. [ ] **å¼‚å¸¸è‡ªæ„ˆ (Self-Healing Loop)**:
    - **å®šä½ä¿®å¤**: è‹¥å‘ç”Ÿ `TimeoutError`ï¼ŒDebugger å¿…é¡»è‡ªåŠ¨æˆªå›¾å¹¶é‡æ–°å¯¹æŠ¥é”™åŒºåŸŸæ‰§è¡Œä¸€æ¬¡ `Perception Plugin`ã€‚
    - **é€»è¾‘ä¿®æ­£**: å¯¹æ¯”â€œæŽ¢æµ‹åˆ°çš„æ–° DOMâ€ä¸Žâ€œæ—§è„šæœ¬é€‰æ‹©å™¨â€ï¼Œè‡ªåŠ¨ç”Ÿæˆä¿®æ­£è¡¥ä¸å¹¶é‡æ–°è¿è¡Œã€‚
    - **çŠ¶æ€ä¿®å¤**: è‹¥å› é¡µé¢æœªè·³è½¬å¯¼è‡´å¤±è´¥ï¼Œè¡¥å†™ `wait_for_load_state` æˆ– `click` è¡¥æ•‘æŽªæ–½ã€‚

4. [ ] **æ•´ç†å·¥ä½œåŒº**:
    - åˆ é™¤æ‰€æœ‰è°ƒè¯•æœŸé—´ç”Ÿæˆçš„è„šæœ¬ï¼Œåªä¿ç•™å¯ä»¥è¿›è¡Œå¤çŽ°çš„è„šæœ¬
    - è¯·åœ¨å·¥ä½œåŒºåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹ï¼Œä¿ç•™æœ¬æ¬¡æµ‹è¯•çš„ç»“æžœ

5. [ ] **è‡ªåŠ¨åŒ–æŠ¥å‘Šæ’°å†™ (Reporting)**:
    - **æ‰§è¡Œæ‘˜è¦**: åŒ…å« [Step ID | çŠ¶æ€ | è€—æ—¶ | APIå“åº”]ã€‚
    - **äº¤ä»˜ç‰©**: è¾“å‡ºä¸€ä»½ç²¾ç®€ã€ç¨³å¥ã€å¯å¤çŽ°çš„ç”Ÿäº§çº§ Python æµ‹è¯•è„šæœ¬ã€‚

---

### ðŸ›  æ ¸å¿ƒæ„ŸçŸ¥ç»„ä»¶ (Perception Plugin - JS Code)
*Script Engineer åœ¨æŽ¢æµ‹æ—¶åº”è‡ªä¸»æ³¨å…¥æ­¤è„šæœ¬ï¼š*



```javascript
(scope = ".el-dialog") => {
  const container = document.querySelector(scope) || document.body;
  return Array.from(container.querySelectorAll('.el-form-item')).map(item => {
    const label = item.querySelector('.el-form-item__label')?.innerText.trim();
    const input = item.querySelector('input, textarea, .vue-treeselect');
    if (!label || !input) return null;
    return {
      field: label.replace(/[:ï¼š*]/g, ''),
      selector: input.placeholder || label,
      type: input.className.includes('treeselect') ? 'treeselect' : 
            item.querySelector('.el-select') ? 'select' : 'standard'
    };
  }).filter(i => i !== null);
}